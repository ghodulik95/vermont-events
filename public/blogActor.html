<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EventBroker Feed</title>
  <style>
    #feed {
      max-width: 600px;
      margin: 2rem auto;
      font-family: sans-serif;
    }
    .post {
      border-bottom: 1px solid #ddd;
      padding: 1rem 0;
    }
    .post h4 {
      margin: 0 0 0.25rem;
    }
    .post time {
      font-size: 0.85em;
      color: #666;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">EventBroker Feed</h2>
  <div id="feed">Loading&hellip;</div>

  <script>
    async function loadEventBrokerFeed() {
      const container = document.getElementById('feed');
      try {
        // 1) Fetch the actor object
        const actorResp = await fetch(
          'https://blog.vermontmobilizon.xyz/users/eventbroker',
          { headers: { 'Accept': 'application/activity+json' } }
        );
        if (!actorResp.ok) throw new Error('Could not fetch actor');
        const actor = await actorResp.json();

        // 2) Fetch their outbox
        const outboxUrl = actor.outbox;
        const outboxResp = await fetch(outboxUrl, {
          headers: { 'Accept': 'application/activity+json' }
        });
        if (!outboxResp.ok) throw new Error('Could not fetch outbox');
        const outbox = await outboxResp.json();

        // 3) Grab the items (newest first)
        const items = outbox.orderedItems || outbox.items || [];

        // 4) Render
        container.innerHTML = '';
        if (!items.length) {
          container.textContent = 'No posts found.';
          return;
        }
        items.slice(0, 10).forEach(item => {
          const post = document.createElement('div');
          post.className = 'post';

          // Title or summary
          const title = item.summary || item.content || '(no content)';
          post.innerHTML = `
            <h4>${title}</h4>
            <time datetime="${item.published}">
              ${new Date(item.published).toLocaleString()}
            </time>
          `;
          container.appendChild(post);
        });

      } catch (err) {
        container.textContent = 'Error loading feed: ' + err.message;
        console.error(err);
      }
    }

    loadEventBrokerFeed();
  </script>
</body>
</html>
